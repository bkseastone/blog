---
layout: page
title: linux环境编程基础
categories: [工程能力]
tags: [cs]
keywords: 
description: 摘要描述
mathjax: true
---

## 内核

待续

## 文件描述符

内核为每个进程维护一个文件打开记录表，文件描述符为该文件在表中的索引值。

## 文件

采用引用计数方式访问文件，当引用计数器为零时，内存管理机制便会对其进行垃圾回收。

对于以下选中的情况，引用计数器会自加1：

- [x] 创建文件
- [ ] 对该文件建立一个硬链接
- [x] 对该文件建立一个软链接
- [x] 每有一个进程访问该文件

一个文件包括三项，目录项（*dentry*结构）、索引节点（*inode*结构）和文件数据。

1. 目录项包括文件名和指向索引节点的指针等信息（当用*unlink*函数删除该项时，便在该目录中看不见该文件）；
2. 索引节点包括链接数、文件所有者、文件在磁盘的位置等文件属性；
3. 文件数据便是在磁盘上的数据块。

**当对该文件建立硬链接（`ln src src_ln`）时，会额外创建*dentry*结构和*inode*结构，但两者的节点号一样（节点号可认为是文件数据的地址）；而当建立符号链接（`ln -sfn src src_ln`）时，则是额外创建了一个文本文件，里面包含了源文件的位置信息。两者完全不同，也不能抽象地比较优劣，只能就具体情况来说。**

## 文件系统

* 实际文件系统（linux为ext文件系统）包括引导块、超级块（记录文件系统的管理信息）、索引节点区（保证了ext文件系统只有一个根节点）和数据区，其中超级块与索引节点区是区分文件系统有无的界限；
* 虚拟文件系统只存于内存中，它的存在使得操作系统能够兼容足够多的文件系统，具体是将其他文件系统进行封装，并挂载到ext文件系统的目录树下，以使得内核能够以一致的方式访问其他文件系统；
* 特殊文件系统proc，也只存于内存中，是内核的窗口，用于查看内核运行的实时信息。

## 库

* 在编译链接的过程中，链接器搜索静态库（archives）时会链接所有已引用却未处理的符号，而未引用或已处理的符号不会从静态库中链接出来，故链接库的链接位置应放置在命令行尾部，否则会出现符号未处理的情况；
* 调用动态库的方式类似于对数据文件的读取，故只有在程序执行时才会装入内存，注意编译链接时须有链接选项`-ldl`；
* 创建静态库的命令为`ar cr libtest.a test1.o test2.o`，编译成动态库的命令为`g++ -fPIC -shared -o libtest.so test1.o test2.o`。

> 因为c不支持函数重载（即与c++函数签名方式不同），所以在c/c++混合编程时，须用extern "c" {}将c代码封装。

## 僵尸进程

在每个进程退出的时候，内核释放该进程所有的资源，包括打开的文件、占用的内存等，但是仍然为其保留一定的信息(包括进程号，退出状态，运行时间等)， 只有父进程通过*wait/waitpid*来取时才释放，否则其进程号就会一定被占用，这样就导致了僵尸进程的问题。